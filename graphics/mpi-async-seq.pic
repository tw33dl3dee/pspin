.PS

#maxpswid = 2000;
#maxpsht = 2000;

#boxht = 2;
boxwid = 1.7;

copy "inc/sequence.pic";

# Define the objects
object(P1,"P1:процесс");
object(Q1,"Q1:очередь MPI");
object(C1,"C1:коммуникатор MPI");
object(C2,"C2:коммуникатор MPI");
object(Q2,"Q2:очередь MPI");
object(P2,"P2:процесс");
step();

active(P1);
active(P2);
step();

message(P1,Q1,"получение буфера");
active(Q1);
message(P2,Q2,"освобождение буфера");
active(Q2);
async();
message(Q2,C2,"MPI_Irecv");
sync();
active(C2);
inactive(C2);
rmessage(Q1,P1,"буфер");
inactive(Q1);
rmessage(Q2,P2,"");
inactive(Q2);

message(P2,P2,"локальная работа");
active(P2);
message(P1,P1,"запись данных в буфер");
active(P1);
step();
inactive(P1);

message(P1,Q1,"отправка буфера");
active(Q1);
async();
message(Q1,C1,"MPI_Isend");
active(C1);
message(C1,C2,"данные");
sync();
rmessage(Q1,P1,"");
inactive(Q1);
inactive(C1);
inactive(P2);

message(P1,Q1,"получение буфера");
active(Q1);
message(Q1,C1,"MPI_Wait");
active(C1);

message(P2,Q2,"запрос буфера");
active(Q2);

message(Q2,C2,"MPI_Wait");
active(C2);
async();
message(C2,C1,"подтверждение");
sync();
rmessage(C2,Q2,"принятый буфер");
inactive(C2);

rmessage(C1,Q1,"OK");
inactive(C1);

rmessage(Q2,P2,"буфер");
inactive(Q2);

rmessage(Q1,P1,"буфер");
inactive(Q1);

message(P2,Q2,"освобождение буфера");
active(Q2);
async();
message(Q2,C2,"MPI_Irecv");
sync();
rmessage(Q2,P2,"");
inactive(Q2);

# Complete the lifelines
step();
complete(P1);
complete(Q1);
complete(C1);
complete(C2);
complete(Q2);
complete(P2);

.PE
