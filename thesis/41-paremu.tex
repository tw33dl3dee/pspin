\chapter{Имитация параллельного выполнения}
\label{cha:paremu}

Для проверки расчетов из \ref{sec:state-partition} был создан прототип
системы, имитирующий параллельную генерацию состояний с распределенным
хранением (см. \ref{sec:par-algo}). Данный прототип состоит из
транслятора, разбирающего модель на языке PROMELA, и генератора
состояний на языке С.

В качестве модели использовалась приведенная в \ref{sec:promela}
модель задачи об обедающих философов для случаев $P = 5, 6, \text{ и }
7$ (количество процессов совпадает с количеством философов). В
качестве \Code{NodeState} используются оба рассмотренных в
\ref{sec:state-partition} варианта: хэш-функция от всего состояния и
от состояния первого процесса. 

Результаты экспериментов для имитации ЛВС из 4 узлов представлены в
табл.~\ref{tab:paremu-stats}. В столбцах <<Состояния>> и <<Переходы>> указано
общее число состояний и переходов модели. В столбце <<Удаленные вызовы>> --
число (суммарное по всем узлам) удаленных вызовов за время имитации; слева от
<</>> -- при использовани хэш-функции от всего состояния, справа -- от состояния
одного процесса. в столбце <<Загруженность узлов>> в качестве меры
<<равномерности>> распределения состояний между узлами показано отношение
минимального и максимального объема используемой памяти среди всех узлов.

\begin{table}[ht]
  \centering
  \begin{tabular}[ht]{|r|l|l|l|p{0.22\textwidth}|}
    \hline
    P & Состояния & Переходы & Удаленные вызовы & Загруженность узлов    \\
    \hline
    5 & 28351     & 42658    & 31356  (73\%)/ 7047  (16\%) & 0.99 / 0.66 \\ 
    6 & 147774    & 232748   & 170378 (73\%)/ 31668 (13\%) & 0.99 / 0.68 \\ 
    7 & 360354    & 601462   & 453789 (75\%)/ 66438 (11\%) & 0.99 / 0.74 \\ 
    \hline
  \end{tabular}
  \caption{Результаты имитации параллельной генерации}
  \label{tab:paremu-stats}
\end{table}

Из приведенных выше результатов можно сделать следующие выводы:

\begin{enumerate}
\item При использовании в качестве \Code{StateNode} хэша всего состояния число
  удаленных вызовов действительно приближается к числу всех переходов, как и
  следует из (\ref{eq:nmsg-full-hash}).

\item Использование вместо нее хэша от состояния только одного (первого)
  процесса приводит к значительному сокращению числа удаленных
  вызовов, которое довольно точно оценивается~(\ref{eq:nmsg-firstproc-hash}).

\item Равномерность распределения состояний между узлами падает в последнем
  случае, что приводит к простою части памяти  (до 30\% на некоторых узлах),
  поэтому возможно дальнейшее улучшение функции распределения.
\end{enumerate}

% FullHash

% N S         T       M               L
% 5 28351     42658   31356 (73\%)    0.99
% 6 147774    232748  170378 (73\%)   0.99
% 7 360354    601462  453789 (75\%)   0.99

% PartHash

% N S         T       M               L
% 5 28351     42658   7047 (16\%)     0.66
% 6 147774    232748  31668 (13\%)    0.68
% 7 360354    601462  66438 (11\%)    0.74

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% End: 
